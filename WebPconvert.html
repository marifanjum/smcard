<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Clipboard to WebP Converter</title>
</head>
<body>

  <button id="convertButton">Convert Clipboard Image to WebP</button>
  
  <script>
    // Function to convert image to WebP format and initiate download
    const convertAndDownloadAsWebP = (imageDataUrl) => {
      // Create a temporary canvas
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');

      // Create an image element to load the pasted image
      const img = new Image();
      img.onload = () => {
        // Set canvas dimensions to match the image
        canvas.width = img.width;
        canvas.height = img.height;

        // Draw the image onto the canvas
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        // Convert canvas content to WebP format
        canvas.toBlob(blob => {
          // Create a temporary link element to initiate download
          const link = document.createElement('a');
          link.download = 'converted_image.webp';
          link.href = URL.createObjectURL(blob);
          
          // Simulate click to initiate download
          link.click();

          // Release the object URL
          URL.revokeObjectURL(link.href);
        }, 'image/webp', 0.5); // Quality set to 0.5
      };

      // Load the pasted image into the image element
      img.src = imageDataUrl;
    };
	
	// Add event listener for convert button click
    const convertButton = document.getElementById('convertButton');
    convertButton.addEventListener('click', () => {
      // Trigger paste event to read image from clipboard
      const pasteEvent = new ClipboardEvent('paste');
      document.dispatchEvent(pasteEvent);
    });

    // Add event listener for paste event
    document.addEventListener('paste', event => {
      const items = (event.clipboardData || event.originalEvent.clipboardData).items;
      for (let index in items) {
        const item = items[index];
        if (item.kind === 'file' && item.type.includes('image')) {
          const blob = item.getAsFile();
          const reader = new FileReader();
          reader.onload = function(event) {
            const imageDataUrl = event.target.result;
            convertAndDownloadAsWebP(imageDataUrl);
          };
          reader.readAsDataURL(blob);
          break;
        }
      }
    });
  </script>
</body>
</html>
